<!DOCTYPE html>
<html>
<head>
  <title>Web Dev Toolkit Pro</title>
  <style>
    /* === Light Theme (Default) CSS Variables === */
    :root {
        --bg-color: #f8f9fa; --text-color: #212529; --border-color: #dee2e6;
        --input-bg: #fff; --primary-color: #007bff; --primary-hover: #0056b3;
        --secondary-color: #6c757d; --secondary-hover: #5a6268;
        --danger-color: #dc3545; --danger-hover: #c82333; --success-color: #28a745;
        --success-hover: #218838; --warn-color: #ffc107; --warn-hover: #e0a800;
        --warn-text-color: black; --info-bg: #d1ecf1; --info-text: #0c5460;
        --info-border: #bee5eb; --success-bg: #d4edda; --success-text: #155724;
        --success-border: #c3e6cb; --error-bg: #f8d7da; --error-text: #721c24;
        --error-border: #f5c6cb; --icon-bg: #f8f9fa; --icon-border: #ced4da;
        --icon-text: #495057; --suggestion-bg: #e9ecef; --suggestion-hover-bg: #dae0e5;
        --suggestion-text: #007bff; --suggestion-hover-text: #004085;
        --label-color: #495057; --placeholder-color: #6c757d; --hr-color: #dee2e6;
    }

    /* === Dark Theme CSS Variable Overrides === */
    body[data-theme="dark"] {
        --bg-color: #212529; --text-color: #e9ecef; --border-color: #495057;
        --input-bg: #343a40; --primary-color: #3794ff; --primary-hover: #1e7eeb;
        --secondary-color: #5a6268; --secondary-hover: #495057;
        --danger-hover: #b12d31; --success-hover: #317d2e; --warn-hover: #d99e00;
        --info-bg: #2c5364; --info-text: #bee5eb; --info-border: #3c7a89;
        --success-bg: #1d4d23; --success-text: #c3e6cb; --success-border: #2c6f33;
        --error-bg: #591d22; --error-text: #f5c6cb; --error-border: #8b2c31;
        --icon-bg: #4a4a4a; --icon-border: #666; --icon-text: #e9ecef;
        --suggestion-bg: #3a3a3a; --suggestion-hover-bg: var(--primary-hover);
        --suggestion-text: #3794ff; --suggestion-hover-text: #fff;
        --label-color: #adb5bd; --placeholder-color: #6c757d; --hr-color: #495057;
    }

    /* === Universal Component Styles (using variables) === */
    body { padding: 15px; width: 340px; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", sans-serif; font-size: 14px; color: var(--text-color); background-color: var(--bg-color); transition: background-color 0.2s, color 0.2s; }
    h3 { margin-top: 20px; margin-bottom: 15px; border-bottom: 1px solid var(--border-color); padding-bottom: 8px; font-size: 16px; color: var(--primary-color); font-weight: 600; }
    h3:first-of-type { margin-top: 0; }
    label { display: block; margin-top: 12px; margin-bottom: 5px; font-weight: 600; font-size: 13px; color: var(--label-color); }
    input, select, textarea, button { width: 100%; margin-bottom: 10px; padding: 9px 12px; box-sizing: border-box; background-color: var(--input-bg); border: 1px solid var(--border-color); color: var(--text-color); border-radius: 4px; font-size: 14px; transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out; }
    input::placeholder, textarea::placeholder { color: var(--placeholder-color); }
    input:focus, select:focus, textarea:focus { border-color: var(--primary-color); outline: 0; box-shadow: 0 0 0 0.2rem hsla(from var(--primary-color) h s l / 0.25) }
    input[type="file"] { padding: 5px; } input[type="range"] { padding: 0; }
    button { cursor: pointer; background-color: var(--primary-color); color: white; border: none; font-weight: 500; transition: background-color 0.2s ease; }
    button:hover:not(:disabled) { background-color: var(--primary-hover); }
    button:disabled { background-color: #4a4a4a; color: #888; cursor: not-allowed; }
    body[data-theme="light"] button:disabled { background-color: #e9ecef; color: #6c757d; }
    hr { margin: 25px 0; border: 0; border-top: 1px solid var(--hr-color); }
    .main-tools { display: flex; gap: 10px; } .main-tools button { flex: 1; background-color: var(--secondary-color); }
    .main-tools button:hover:not(:disabled) { background-color: var(--secondary-hover); }
    #clearParams { background-color: var(--danger-color); }
    #clearParams:hover:not(:disabled) { background-color: var(--danger-hover); }
    .suggestion-container { margin-top: -5px; margin-bottom: 10px; font-size: 12px; line-height: 1.8; color: var(--label-color); }
    .value-suggestion { color: var(--suggestion-text); background-color: var(--suggestion-bg); cursor: pointer; text-decoration: none; margin-right: 6px; padding: 2px 5px; border-radius: 3px; display: inline-block; margin-bottom: 4px; }
    .value-suggestion:hover { color: var(--suggestion-hover-text); background-color: var(--suggestion-hover-bg); text-decoration: underline; }
    #toggleSfmcUnwrapper.enabled { background-color: var(--success-color); }
    #toggleSfmcUnwrapper.enabled:hover:not(:disabled) { background-color: var(--success-hover); }
    #toggleSfmcUnwrapper.disabled { background-color: var(--secondary-color); }
    #status, #htmlCheckerResult { display: none; word-wrap: break-word; }
    #status:not(:empty), #htmlCheckerResult:not(:empty) { display: block; margin-top: 10px; min-height: 1.2em; font-size: 13px; font-weight: 500; padding: 8px 12px; border-radius: 4px; text-align: center; }
    #status.error, #htmlCheckerResult.error { background-color: var(--error-bg); color: var(--error-text); border: 1px solid var(--error-border); }
    #status.success, #htmlCheckerResult.success { background-color: var(--success-bg); color: var(--success-text); border: 1px solid var(--success-border); }
    #status.info { background-color: var(--info-bg); color: var(--info-text); border: 1px solid var(--info-border); }
    #overlayIconToolbar { display: none; justify-content: flex-start; gap: 8px; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid var(--border-color); }
    .icon-button { background-color: var(--icon-bg); border-color: var(--icon-border); color: var(--icon-text); padding: 6px 0; font-size: 12px; border-radius: 4px; cursor: pointer; flex: 1; text-align: center; font-weight: 600; }
    .icon-button:hover:not(:disabled) { background-color: #5a5a5a; }
    body[data-theme="light"] .icon-button:hover:not(:disabled) { background-color: #e9ecef; }
    .icon-button.active-vis, .icon-button.active-lock { background-color: var(--primary-color); color: white; border-color: var(--primary-hover); }
    .icon-button.inactive-vis, .icon-button.inactive-lock { background-color: var(--secondary-color); color: white; border-color: var(--secondary-hover); }
    #resetOverlay { background-color: var(--warn-color); color: var(--warn-text-color); }
    #resetOverlay:hover:not(:disabled) { background-color: var(--warn-hover); }
    .spinner { border:3px solid hsla(from var(--text-color) h s l / 0.1); width:18px; height:18px; border-radius:50%; border-left-color: var(--primary-color); animation:spin .8s linear infinite; display:none; margin:10px auto }
    .spinner.active{display:block} @keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
    
    /* Theme Switcher Styles */
    .theme-switcher { position: absolute; top: 10px; right: 10px; }
    .theme-switcher label { display: flex; align-items: center; cursor: pointer; font-size: 11px; font-weight: 500; color: var(--label-color); }
    .theme-switcher input { display: none; }
    .switch-track { width: 34px; height: 18px; background: #ccc; border-radius: 9px; position: relative; transition: background-color 0.2s; margin-left: 5px; }
    body[data-theme="dark"] .switch-track { background: #555; }
    .switch-thumb { width: 14px; height: 14px; background: white; border-radius: 50%; position: absolute; top: 2px; left: 2px; transition: transform 0.2s; }
    input:checked + .switch-track { background: var(--primary-color); }
    input:checked + .switch-track .switch-thumb { transform: translateX(16px); }
  </style>
</head>
<body data-theme="light">
    
    <div class="theme-switcher">
        <label for="themeToggle">
            Dark
            <input type="checkbox" id="themeToggle">
            <span class="switch-track"><span class="switch-thumb"></span></span>
        </label>
    </div>

    <h3>Page Tools</h3>
    <div class="main-tools">
        <button id="rulerModeButton" title="Toggle an on-page measuring tool (Press Esc on page to exit)">Ruler Mode</button>
        <button id="multiViewButton" title="Show Dev, QA, and Prod side-by-side">Multi-View</button>
    </div>
    <hr>
    <h3>URL Tools</h3>
    <label for="paramNameSelect">Parameter Name:</label> <input type="text" id="paramNameCustom" placeholder="Or type custom name"> <select id="paramNameSelect"><option value="">-- Select or type custom --</option></select>
    <label for="paramValue">Parameter Value:</label> <input type="text" id="paramValue" placeholder="Parameter value">
    <div id="valueSuggestions" class="suggestion-container"><i>Loading suggestions...</i></div> <div id="status"></div> <div id="loadingSpinnerUrlTools" class="spinner"></div>
    <button id="addParam">Add Parameter(s)</button> <button id="clearParams">Clear All Parameters</button>
    <button id="clearSuggestionsButton" style="background-color: #ffc107; color: black;" title="Clear all saved parameter name and value suggestions.">Clear Suggestions</button>
    <label for="environmentSelect" style="margin-top:15px;">Switch Environment:</label>
    <select id="environmentSelect">
        <option value="">-- Select Environment --</option>
        <option value="dev_nextcar">Next Car - Dev</option> <option value="qa_nextcar">Next Car - QA</option> <option value="prod_nextcar">Next Car - Prod</option> <option value="usync_nextcar">Next Car - Sync</option>
        <option value="dev_newcar">New Car - Dev</option> <option value="qa_newcar">New Car - QA</option> <option value="prod_newcar">New Car - Prod</option> <option value="usync_newcar">New Car - Sync</option>
        <option value="dev_acar">A-Car - Dev</option> <option value="qa_acar">A-Car - QA</option> <option value="prod_acar">A-Car - Prod</option> <option value="usync_acar">A-Car - Sync</option>
        <option value="dev_fs">FS - Dev</option> <option value="qa_fs">FS - QA</option> <option value="prod_fs">FS - Prod</option> <option value="usync_fs">FS - Sync</option>
        <option value="dev_retail">Retail - Dev</option> <option value="qa_retail">Retail - QA</option> <option value="prod_retail">Retail - Prod</option> <option value="usync_retail">Retail - Sync</option>
    </select>
    <button id="toggleSfmcUnwrapper" style="margin-top: 15px;">Toggle SFMC Unwrapper</button>
    <hr>
    <h3>HTML Tag Checker</h3>
    <label for="htmlCheckerTextarea">Paste Email HTML Code Here:</label>
    <textarea id="htmlCheckerTextarea" rows="8" placeholder="e.g., <table><tr><td>...</td></tr></table>"></textarea>
    <div id="htmlCheckerResult"></div>
    <button id="checkHtmlButton">Check HTML Tags</button>
    <hr>
    <h3>Pixel Perfect Overlay</h3>
    <div id="overlayIconToolbar" style="display:none;">
        <button id="iconToggleVisibility" class="icon-button" title="Toggle Overlay Visibility">VIS</button>
        <button id="iconToggleLock" class="icon-button" title="Lock/Unlock Overlay Controls">LOCK</button>
        <button id="iconRulerMode" class="icon-button" title="Toggle Ruler Mode">RULER</button>
    </div>
    <label for="imageUpload">Upload Design Image:</label> <input type="file" id="imageUpload" accept="image/png, image/jpeg, image/gif, image/webp, image/svg+xml">
    <div id="overlayControls" style="display:none;">
        <label>Origin (X, Y):</label> <div class="coords"><input type="number" id="overlayPosX" value="0" title="X Position"> <input type="number" id="overlayPosY" value="0" title="Y Position"></div>
        <label for="overlayOpacity">Opacity: <span id="overlayOpacityValue">100</span>%</label> <input type="range" id="overlayOpacity" min="0" max="100" value="100" step="1">
        <label for="overlayScaleInput">Scale (e.g., 0.5, 1, 1.5):</label> <input type="number" id="overlayScaleInput" value="1.00" min="0.1" max="5" step="0.05">
        <div id="loadingSpinnerOverlay" class="spinner"></div>
        <button id="resetOverlay">Remove Overlay Image</button>
    </div>
    <script src="popup.js"></script>
</body>
</html>